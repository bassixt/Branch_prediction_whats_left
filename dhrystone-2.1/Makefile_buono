CC=		cl			# C compiler name goes here (MSC)
CC=		cc			# C compiler name goes here (UNIX)
GCC=		aarch64-unknown-linux-gnueabi-gcc
# Added by us
CROSS_PREFIX=aarch64-unknown-linux-gnueabi-

PROGS=		msc			# Programs to build (MSC)
PROGS=		unix			# Programs to build (UNIX)

#TIME_FUNC=	-DMSC_CLOCK		# Use Microsoft clock() for measurement
TIME_FUNC=	-DTIME			# Use time(2) for measurement
#TIME_FUNC=	-DTIMES			# Use times(2) for measurement
#HZ=		50			# Frequency of times(2) clock ticks
HZ=		60			# Frequency of times(2) clock ticks
#HZ=		100			# Frequency of times(2) clock ticks
#HZ=		1			# Give bogus result unless changed!

STRUCTASSIGN=	-DNOSTRUCTASSIGN	# Compiler cannot assign structs
STRUCTASSIGN=				# Compiler can assign structs

ENUMS=		-DNOENUMS		# Compiler doesn't have enum type
ENUMS=					# Compiler does have enum type

OPTIMIZE=	-Ox -G2			# Optimization Level (MSC, 80286)
OPTIMIZE=	-O4			# Optimization Level (generic UNIX)
GCCOPTIM=       -O

LFLAGS=					#Loader Flags

CFLAGS=	$(OPTIMIZE) $(TIME_FUNC) -DHZ=$(HZ) $(ENUMS) $(STRUCTASSIGN) $(CFL)
CFLAGS=
GCCFLAGS= $(GCCOPTIM) $(TIME_FUNC) -DHZ=$(HZ) $(ENUMS) $(STRUCTASSIGN) $(CFL)

#
#		You shouldn't need to touch the rest
#
SRC=		dhry_1.c dhry_2.c
HDR=		dhry.h

all:	test64.bin

unix:	$(UNIX_PROGS)

msc:	$(MSC_PROGS)
# OLD COMPILATION LINES
#cc_dry2:		$(SRC) $(HDR)
#		$(CC) $(CFLAGS) $(SRC) $(LFLAGS) -o $@

###########################################################################################
###########################################################################################
########################     Added by us -START    ########################################
###########################################################################################
###########################################################################################

cc_dry1.o: dhry_1.c dhry.h
	aarch64-unknown-linux-gnueabi-gcc -c  dhry_1.c -o cc_dry1.o

#cc_dry2.o: dhry_2.c dhry.h
#	aarch64-unknown-linux-gnueabi-gcc -c  dhry_2.c -o cc_dry2.o

startup64.o: startup64.s
	aarch64-unknown-linux-gnueabi-as -c startup64.s -o startup64.o

#test64.elf: cc_dry1.o cc_dry2.o startup64.o
#	aarch64-unknown-linux-gnueabi-ld cc_dry1.o cc_dry2.o -o test64.elf


#test64.elf: cc_dry1.o cc_dry2.o startup64.o
#	aarch64-unknown-linux-gnueabi-ld -T test64.ld cc_dry1.o cc_dry2.o startup64.o -static -L/home/mc/Scrivania/dhrystone-2.1/Newlib/musl/lib  -o test64.elf -static -lc

test64.elf: cc_dry1.o startup64.o
		aarch64-unknown-linux-gnueabi-ld -T test64.ld cc_dry1.o startup64.o -static -L/home/mc/Scrivania/dhrystone-2.1/Newlib/musl/lib  -o  test64.elf -static -lc


test64.bin: test64.elf
	aarch64-unknown-linux-gnueabi-objcopy -O binary test64.elf test64.bin

###########################################################################################
###########################################################################################
########################    Added by us -FINISH    ########################################
###########################################################################################
###########################################################################################

clean:
	-rm -f *.o *.obj *.elf *.bin
